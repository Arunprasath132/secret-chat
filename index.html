<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERMINAL_BRIDGE_V1.0</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* OLD SCHOOL TERMINAL STYLING */
        * { box-sizing: border-box; }
        body { 
            background-color: #000; 
            color: #00ff00; 
            font-family: "Courier New", Courier, monospace; 
            margin: 0; 
            height: 100vh; 
            display: flex;
            flex-direction: column;
        }

        .hidden { display: none !important; }

        /* HEADER */
        header { 
            border-bottom: 2px solid #00ff00; 
            padding: 10px; 
            display: flex; 
            justify-content: space-between;
            background: #000;
        }

        /* LOGIN BOX */
        #loginSection {
            margin: auto;
            border: 2px solid #00ff00;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        input {
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 10px;
            width: 100%;
            margin-bottom: 10px;
            outline: none;
            font-family: inherit;
        }

        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            font-family: inherit;
            text-transform: uppercase;
        }

        button:hover { background: #00cc00; }

        /* CHAT AREA */
        #chatSection {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #messages {
            flex: 1;
            overflow-y: scroll;
            padding: 20px;
            border-bottom: 2px solid #00ff00;
        }

        .msg { margin-bottom: 10px; line-height: 1.4; }
        .system { color: #ffff00; font-style: italic; }
        .time { color: #008800; font-size: 0.8em; margin-right: 10px; }
        .user { font-weight: bold; color: #fff; margin-right: 5px; }

        /* INPUT BAR */
        .input-area {
            display: flex;
            padding: 10px;
            background: #000;
        }

        #msgInput { flex: 1; margin-right: 10px; margin-bottom: 0; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #00ff00; }
    </style>
</head>
<body>

    <div id="loginSection">
        <h2>[ BRIDGE_LOGIN ]</h2>
        <p>IDENTIFY TUNNEL PARAMETERS:</p>
        <input type="text" id="roomInput" placeholder="TUNNEL_ID">
        <input type="password" id="passInput" placeholder="ACCESS_KEY">
        <button onclick="connect()">Establish Link</button>
    </div>

    <div id="chatSection" class="hidden">
        <header>
            <div>STATUS: CONNECTED // ROOM: <span id="roomDisp"></span></div>
            <button onclick="wipe()" style="background: #ff0000; color: #fff; padding: 2px 10px; font-size: 10px;">PURGE_ALL</button>
        </header>

        <div id="messages"></div>

        <div class="input-area">
            <span style="padding-top:10px; margin-right:5px;">></span>
            <input type="text" id="msgInput" placeholder="ENTER_DATA..." onkeypress="if(event.key==='Enter') send()">
            <button onclick="send()">SEND</button>
        </div>
    </div>

    <script>
        const socket = io();
        let currentRoom = "";

        function connect() {
            const r = document.getElementById('roomInput').value;
            const p = document.getElementById('passInput').value;
            if(r && p) {
                currentRoom = r;
                socket.emit('join-room', { key: r, password: p });
            }
        }

        socket.on('login-success', () => {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('chatSection').classList.remove('hidden');
            document.getElementById('roomDisp').innerText = currentRoom;
        });

        socket.on('load-history', (history) => {
            history.forEach(d => append(d));
        });

        function send() {
            const i = document.getElementById('msgInput');
            if(i.value) {
                socket.emit('send-message', { room: currentRoom, message: i.value });
                i.value = "";
            }
        }

        socket.on('receive-message', (data) => append(data));

        function append(d) {
            const m = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = 'msg';
            
            if(d.type === 'system') {
                div.innerHTML = `<span class="system">${d.text}</span>`;
            } else {
                const isMe = d.senderId === socket.id;
                div.innerHTML = `
                    <span class="time">[${d.time}]</span>
                    <span class="user">${isMe ? '<YOU>' : '<NODE>'}</span>
                    <span>${d.text}</span>
                `;
            }
            m.appendChild(div);
            m.scrollTop = m.scrollHeight;
        }

        socket.on('force-logout', () => {
            alert("SESSION_TERMINATED: MEMORY_PURGED");
            location.reload();
        });

        function wipe() {
            if(confirm("EXECUTE GLOBAL PURGE?")) socket.emit('end-session', currentRoom);
        }
    </script>
</body>
</html>
